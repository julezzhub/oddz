<div id="page1">
  <h3>Your target: <%= params[:title] %></h3>
  <%= simple_form_for(@bet) do |f| %>
  <% if params[:target][:kind] == "youtube#video" %>
    <%= hidden_field_tag :target, params[:target][:videoId] %>
    <div id="metric">
        <h3 class="form-h3">Now Select your betting metric, quantity and time period</h3>
        <%= f.input :metric, label: "Select Video Metric", collection: ['Views', 'Likes', 'Dislikes', 'Comments'] %>
    </div>
  <% else %>
    <%= hidden_field_tag :target, params[:target][:channelId] %>
    <div id="metric">
      <h3 class="form-h3">Now Select your betting metric, quantity and time period</h3>
      <%= f.input :metric, label: "Select Channel Metric", collection: ['Subscribers', 'View Count'] %>
    </div>
  <% end %>

  <div class="d-none", id="metric-count">
    <%= f.input :metric_count, label: "Amount" %>
  </div>

  <div class="d-none", id="time">
    <div class="row">
      <div class="col">
        <p>Days</p>
        <%= select_tag :days, options_for_select(0..30) %>
      </div>
      <div class="col">
        <p>Hours</p>
        <%= select_tag :hours, options_for_select(0..23) %>
      </div>
<!--  <div class="col">
        <p>Minutes</p>
        <%#= select_tag :minutes, options_for_select(0..59)%>
      </div> -->
      <%= hidden_field_tag :duration, 0, id:"duration" %>
    </div>
  </div>

  <%= link_to new_search_path do %>
    <%= image_tag "arrow_left.svg" %>
  <% end %>
  <%= image_tag "arrow_right.svg", id:"recipe1forward", class:"d-none" %>

</div>

<div class="d-none" id=page2>
  <h3 class="form-h3">Last but not least, choose an amount and a friend</h3>

  <%= f.input :stake, label: 'Stake (€)', input_html: { class: 'js-range-slider1'} %>

  <div id="friend-selection">
    <%= f.input :friend, label: 'Choose your friend', collection: current_user.friend_names %>
<!--<%#= select_tag :friend, options_from_collection_for_select(current_user.friends, 'id', 'username'), label: "Choose your friend" %> -->
  </div>

  <%= image_tag "arrow_left.svg", id:"recipe2backward" %>
  <%= image_tag "arrow_right.svg", id:"recipe2forward", class:"d-none" %>
</div>

<div class="d-none" id="summary">
  <h3 class="form-h3">Done. See your bet summary below and hit bet!</h3>

  <div style="display: grid; grid-template-columns: 1fr 3fr">
    <%= image_tag "video.svg", style:"width: 80px; height: 80px;" %>
    <h3 id="target-summary"></h3>
    <%= image_tag("thumbs_up.svg") %>
    <h3 id="metric_count_time-summary"></h3>
    <%= image_tag("wallet.svg") %>
    <h3 id="stake-summary"></h3>
    <%= image_tag "friend.svg", style:"width: 80px; height: 80px;" %>
    <h3 id="friend-summary"></h3>
  </div>
  <%= image_tag "arrow_left.svg", id:"summary-backward" %>
  <%= f.button :submit, value:"BET", style:"color: white;" %>
  <% end %>
</div>

<script>
  document.getElementById('metric').addEventListener('change', function() {
    document.getElementById('bet_metric_count').placeholder = "How many " +
      document.getElementById('bet_metric').value.toLowerCase() + " will the target get?"
    document.getElementById('metric-count').classList.remove('d-none')
  })
  // when a metric is selected, change the placeholder of the next field and show it

  document.getElementById('metric-count').addEventListener('change', function() {
    document.getElementById('time').classList.remove('d-none')
  })
  // when a metric count is selected, show the time field

  const recipe1forward = document.getElementById('recipe1forward')

  document.getElementById('time').addEventListener('change', function() {
    document.getElementById('duration').value =
      document.getElementById('days').value * 86400
      + document.getElementById('hours').value * 3600
/*      + document.getElementById('minutes').value * 60 */
    recipe1forward.classList.remove('d-none')
  })
  // whenever sth in the time field changes, update the "duration" hidden field tag
  // and show the rightward arrow

  recipe1forward.addEventListener('click', function() {
    document.getElementById('page1').classList.add("d-none")
    document.getElementById('page2').classList.remove("d-none")
  })
  // when you click on the rightward arrow, you get to the next page

  const recipe2forward = document.getElementById('recipe2forward')
  const recipe2backward = document.getElementById('recipe2backward')

  document.getElementById('friend-selection').addEventListener('change', function() {
    recipe2forward.classList.remove('d-none')
  })
  // when a friend is selected, show the arrow leading to summary

  recipe2backward.addEventListener('click', function() {
    document.getElementById('page2').classList.add("d-none")
    document.getElementById('page1').classList.remove("d-none")
  })
  // when you click on the leftward arrow, you get to page 1

  recipe2forward.addEventListener('click', function() {
    document.getElementById('page2').classList.add("d-none")
    document.getElementById('summary').classList.remove("d-none")

    document.getElementById('target-summary').innerHTML = "<%= params[:title] %>"

    document.getElementById('metric_count_time-summary').innerHTML =
      parseInt(document.getElementById('bet_metric_count').value, 10).toLocaleString() + " "
      + document.getElementById('bet_metric').value + " in "
      + document.getElementById('days').value + " days and "
      + document.getElementById('hours').value + " hours."
/*      + document.getElementById('minutes').value + " minutes."
*/
    document.getElementById('stake-summary').innerHTML =
      document.getElementById('bet_stake').value + "€"

    document.getElementById('friend-summary').innerHTML =
      document.getElementById('bet_friend').value
  })
  // when you click on the rightward arrow, you get to the summary page
  // which is simultaneously being populated with the user's input
  // (toLocaleString adds the thousand separators on the metric for readability)

  document.getElementById('summary-backward').addEventListener('click', function() {
    document.getElementById('summary').classList.add("d-none")
    document.getElementById('page2').classList.remove("d-none")
  })
  //when you click on the backward arrow, you get to page 2 again
</script>

<%= content_for :after_js do %>
  <%= javascript_pack_tag "new_bet_form" %>
<% end %>
