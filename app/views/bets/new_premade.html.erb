<% duration =  (@premade_bet.premade_days * 86400) + (@premade_bet.premade_hours * 3600) %>
<%#= simple_form_for @bet do  |f| %>
  <%#= f.input :start_time, input_html: {value: Time.now}, as: :hidden %>
  <%#= f.input :end_time, input_html: {value: end_time}, as: :hidden %>
  <%#= f.input :target, input_html: {value: @premade_bet.target}, as: :hidden %>
  <%#= f.input :friend, label: 'Choose your friend', collection: current_user.friend_names %>
  <%#= f.input :stake, label: 'Stake (€)', input_html: { class: 'js-range-slider1'} %>
  <%#= f.input :metric, input_html: {value: @premade_bet.metric}, as: :hidden %>
  <%#= f.input :metric_count, input_html: {value: @premade_bet.metric_count}, as: :hidden %>
  <%#= hidden_field_tag :duration, duration, id:"duration" %>
  <%#= hidden_field_tag :days, @premade_bet.premade_days, id:"days" %>
  <%#= hidden_field_tag :hours, @premade_bet.premade_hours, id:"hours" %>
  <%#= hidden_field_tag :target, @premade_bet.target, id:"target" %>
  <%#= f.submit %>
<%# end %>

<%= simple_form_for(@bet) do |f| %>
<div id=page2>
  <h3 class="form-h3">Please choose an amount and a friend</h3>

  <%= f.input :stake, label: 'Stake (€)', input_html: { class: 'js-range-slider1'} %>

  <div id="friend-selection">
    <%= f.input :friend, label: 'Choose your friend', collection: current_user.friend_names %>
<!--<%#= select_tag :friend, options_from_collection_for_select(current_user.friends, 'id', 'username'), label: "Choose your friend" %> -->
  </div>
  <%= link_to root_path do %>
    <%= image_tag "arrow_left.svg" %>
  <% end %>
  <%= image_tag "arrow_right.svg", id:"recipe2forward", class:"d-none" %>

</div>

<div class="d-none" id="summary">
  <h3 class="form-h3">Done. See your bet summary below and hit bet!</h3>

  <div style="display: grid; grid-template-columns: 1fr 3fr">
    <%= image_tag "video.svg"%>
    <h3 id="target-summary"></h3>
    <%= image_tag("thumbs_up.svg") %>
    <h3 id="metric_count_time-summary"></h3>
    <%= image_tag("wallet.svg") %>
    <h3 id="stake-summary"></h3>
    <%= image_tag "friend.svg", style:"width: 80px; height: 110px;" %>
    <h3 id="friend-summary"></h3>
  </div>
  <%= image_tag "arrow_left.svg", id:"summary-backward" %>


  <%= f.input :metric, input_html: {value: @premade_bet.metric}, as: :hidden %>
  <%= f.input :metric_count, input_html: {value: @premade_bet.metric_count}, as: :hidden %>
  <%= hidden_field_tag :duration, duration, id:"duration" %>
  <%= hidden_field_tag :days, @premade_bet.premade_days, id:"days" %>
  <%= hidden_field_tag :hours, @premade_bet.premade_hours, id:"hours" %>
  <%= hidden_field_tag :target, @premade_bet.target, id:"target" %>
  <%= hidden_field_tag :title, @premade_bet.video_title, id:"title" %>

  <%= f.button :submit, value:"BET", style:"color: white;" %>
  <% end %>
</div>

<script>

  const recipe2forward = document.getElementById('recipe2forward')
  const recipe2backward = document.getElementById('recipe2backward')

    // when a friend is selected, show the arrow leading to summary

  document.getElementById('friend-selection').addEventListener('change', function() {
    recipe2forward.classList.remove('d-none')
  })

  recipe2forward.addEventListener('click', function() {
    document.getElementById('page2').classList.add("d-none")
    document.getElementById('summary').classList.remove("d-none")

    document.getElementById('target-summary').innerHTML = "<%= @premade_bet.video_title %>"

    document.getElementById('metric_count_time-summary').innerHTML =
      parseInt(document.getElementById('bet_metric_count').value, 10).toLocaleString() + " "
      + document.getElementById('bet_metric').value + " in "
      + document.getElementById('days').value + " days and "
      + document.getElementById('hours').value + " hours."
/*      + document.getElementById('minutes').value + " minutes."
*/
    document.getElementById('stake-summary').innerHTML =
      document.getElementById('bet_stake').value + "€"

    document.getElementById('friend-summary').innerHTML =
      document.getElementById('bet_friend').value
  })
  // when you click on the rightward arrow, you get to the summary page
  // which is simultaneously being populated with the user's input
  // (toLocaleString adds the thousand separators on the metric for readability)

  document.getElementById('summary-backward').addEventListener('click', function() {
    document.getElementById('summary').classList.add("d-none")
    document.getElementById('page2').classList.remove("d-none")
  })
  //when you click on the backward arrow, you get to page 2 again
</script>

<%= content_for :after_js do %>
  <%= javascript_pack_tag "premade_bet_form" %>
<% end %>
